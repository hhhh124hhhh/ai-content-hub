# ğŸ¯ X For You ç®—æ³•é›†æˆ

> é›†æˆ xai-org/x-algorithm åˆ°æˆ‘ä»¬çš„è¯„ä¼°ç³»ç»Ÿä¸­

---

## ğŸ“Š ç®—æ³•æ¦‚è¿°

### æ¥æº
- **GitHub**: https://github.com/xai-org/x-algorithm
- **ç»„ç»‡**: xai-org
- **Stars**: 13,917
- **Forks**: 2,389
- **License**: Apache License 2.0
- **è¯­è¨€**: Rust
- **æœ€åæ›´æ–°**: 2026-01-28

### ç®—æ³•æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FOR YOU FEED REQUEST            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 1. Home Mixer       â”‚
        â”‚ (In-Network Posts)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 2. Thunder          â”‚
        â”‚ (Your Following)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 3. Phoenix          â”‚
        â”‚ (ML-Based Retrieval)  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 4. Candidate Pipeline â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 5. Scoring & Ranking â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ 6. Filtering         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            RANKED FEED                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§  æ ¸å¿ƒç»„ä»¶

### 1. Phoenix - Grok-based Transformer

**å…³é”®ç‰¹æ€§**:
- **åŸºç¡€**: åŸºäº Grok-1 å¼€æºç‰ˆæœ¬æ”¹ç¼–
- **ç›®çš„**: æ¨èç³»ç»Ÿä½¿ç”¨
- **åŠŸèƒ½**: é¢„æµ‹æ¯æ¡æ¨æ–‡çš„å‚ä¸åº¦æ¦‚ç‡

**æ ¸å¿ƒæ€æƒ³**:
> "The Grok-based transformer does all the heavy lifting by understanding your engagement history (what you liked, replied to, shared, etc.) and using that to determine what content is relevant to you."

**è¾“å…¥**:
- ç”¨æˆ·å‚ä¸å†å²ï¼ˆç‚¹èµã€å›å¤ã€åˆ†äº«ï¼‰
- æ¨æ–‡å†…å®¹ï¼ˆæ–‡æœ¬ã€åª’ä½“ã€ä½œè€…ï¼‰
- æ¨æ–‡å…ƒæ•°æ®ï¼ˆæ—¶é—´æˆ³ã€åœ°ç†ä½ç½®ã€è®¾å¤‡ï¼‰
- ç”¨æˆ·ç‰¹å¾ï¼ˆè¯­è¨€ã€æ—¶åŒºã€å…´è¶£ï¼‰

**è¾“å‡º**:
- å‚ä¸åº¦æ¦‚ç‡ (0-1)
- ç›¸å…³æ€§åˆ†æ•° (0-1)
- ç½®ä¿¡åº¦åˆ†æ•° (0-1)

### 2. Thunder - In-Network Posts

**åŠŸèƒ½**: è·å–ä½ å…³æ³¨çš„è´¦å·çš„æ¨æ–‡

**æ•°æ®æµ**:
```
ç”¨æˆ· â†’ Following List â†’ Twitter API â†’ User Timeline â†’ Home Mixer â†’ Candidate Pipeline
```

**ä¼˜åŠ¿**:
- å®æ—¶æ€§
- é«˜ç›¸å…³æ€§
- ä½å»¶è¿Ÿ

### 3. Home Mixer - Content Mixing

**åŠŸèƒ½**: æ··åˆä¸åŒæ¥æºçš„å†…å®¹

**æ··åˆç­–ç•¥**:
- **In-Network**: 40% ï¼ˆæ¥è‡ªä½ å…³æ³¨çš„è´¦å·ï¼‰
- **Out-of-Network**: 40% ï¼ˆé€šè¿‡ ML æ£€ç´¢å‘ç°çš„æ¨æ–‡ï¼‰
- **Ads/Recommended**: 20% ï¼ˆå¹¿å‘Šå’Œæ¨èå†…å®¹ï¼‰

**æ··åˆç®—æ³•**:
```python
def mix_content(in_network, out_of_network, ads, weights):
    """
    æ··åˆä¸åŒæ¥æºçš„å†…å®¹

    å‚æ•°:
        in_network: ä½ å…³æ³¨çš„æ¨æ–‡
        out_of_network: é€šè¿‡ ML æ£€ç´¢å‘ç°çš„æ¨æ–‡
        ads: å¹¿å‘Šå’Œæ¨èå†…å®¹
        weights: æ··åˆæƒé‡ [in_network, out_of_network, ads]
    """
    # æŒ‰æƒé‡éšæœºé€‰æ‹©
    selected = []
    
    for i in range(len(in_network) + len(out_of_network) + len(ads)):
        rand = random.random()
        
        if rand < weights[0]:  # 40% in-network
            selected.append(in_network[i % len(in_network)])
        elif rand < weights[0] + weights[1]:  # 40% out-of-network
            selected.append(out_of_network[i % len(out_of_network)])
        else:  # 20% ads
            selected.append(ads[i % len(ads)])
    
    return selected
```

### 4. Candidate Pipeline

**åŠŸèƒ½**: å€™é€‰å’Œå‡†å¤‡å€™é€‰æ¨æ–‡

**é˜¶æ®µ**:
1. **å»é‡**: ç§»é™¤é‡å¤çš„æ¨æ–‡
2. **è¿‡æ»¤**: ç§»é™¤ä½è´¨é‡çš„æ¨æ–‡
3. **æ’åº**: æŒ‰ç›¸å…³æ€§æ’åº
4. **æ‰¹å¤„ç†**: åˆ†æ‰¹å¤„ç†å€™é€‰æ¨æ–‡

### 5. Scoring & Ranking

**è¯„åˆ†ç³»ç»Ÿ**:
- **åŸºç¡€åˆ†æ•°**: Phoenix é¢„æµ‹çš„å‚ä¸åº¦æ¦‚ç‡
- **æƒé‡è°ƒæ•´**: åŸºäºç”¨æˆ·å†å²åŠ¨æ€è°ƒæ•´
- **å¤šæ ·æ€§**: ç¡®ä¿å†…å®¹å¤šæ ·æ€§
- **æ–°é²œåº¦**: ä¼˜å…ˆæ˜¾ç¤ºæœ€æ–°å†…å®¹

**æ’åç®—æ³•**:
```python
def rank_posts(posts, phoenix_scores, user_history):
    """
    ä½¿ç”¨ Phoenix åˆ†æ•°å’Œç”¨æˆ·å†å²æ’åæ¨æ–‡

    å‚æ•°:
        posts: å€™é€‰çš„æ¨æ–‡
        phoenix_scores: Phoenix é¢„æµ‹çš„åˆ†æ•°
        user_history: ç”¨æˆ·å‚ä¸å†å²
    """
    ranked_posts = []
    
    for i, post in enumerate(posts):
        # åŸºç¡€åˆ†æ•°
        base_score = phoenix_scores[i]
        
        # å†å²ç›¸å…³æ€§
        history_score = calculate_history_relevance(post, user_history)
        
        # æ–°é²œåº¦
        freshness_score = calculate_freshness(post)
        
        # å¤šæ ·æ€§
        diversity_score = calculate_diversity(post, ranked_posts)
        
        # ç»¼åˆåˆ†æ•°
        combined_score = (
            base_score * 0.5 +
            history_score * 0.2 +
            freshness_score * 0.2 +
            diversity_score * 0.1
        )
        
        ranked_posts.append({
            'post': post,
            'score': combined_score
        })
    
    # æŒ‰åˆ†æ•°æ’åº
    ranked_posts.sort(key=lambda x: x['score'], reverse=True)
    
    return ranked_posts

def calculate_history_relevance(post, user_history):
    """
    åŸºäºç”¨æˆ·å†å²è®¡ç®—ç›¸å…³æ€§

    å‚æ•°:
        post: æ¨æ–‡
        user_history: ç”¨æˆ·å‚ä¸å†å²
    """
    # æ£€æŸ¥æ¨æ–‡æ˜¯å¦ä¸ç”¨æˆ·å†å²ç›¸ä¼¼
    similarity = 0
    
    for history_item in user_history:
        # æ–‡æœ¬ç›¸ä¼¼åº¦
        text_similarity = calculate_text_similarity(post['text'], history_item['text'])
        
        # ä½œè€…ç›¸ä¼¼åº¦
        author_similarity = 1 if post['author'] == history_item['author'] else 0
        
        # æ ‡ç­¾ç›¸ä¼¼åº¦
        tag_similarity = calculate_tag_similarity(post['tags'], history_item['tags'])
        
        # ç»¼åˆç›¸ä¼¼åº¦
        item_similarity = (
            text_similarity * 0.6 +
            author_similarity * 0.3 +
            tag_similarity * 0.1
        )
        
        similarity = max(similarity, item_similarity)
    
    return similarity

def calculate_freshness(post):
    """
    è®¡ç®—æ–°é²œåº¦åˆ†æ•°

    å‚æ•°:
        post: æ¨æ–‡
    """
    # æ¨æ–‡å‘å¸ƒæ—¶é—´
    published_at = post['created_at']
    
    # å½“å‰æ—¶é—´
    now = datetime.now()
    
    # æ—¶é—´å·®ï¼ˆå°æ—¶ï¼‰
    time_diff = (now - published_at).total_seconds() / 3600
    
    # æ–°é²œåº¦åˆ†æ•°ï¼ˆè¶Šæ–°åˆ†æ•°è¶Šé«˜ï¼‰
    freshness_score = max(0, 1 - time_diff / 24)  # 24 å°æ—¶å†…çš„å†…å®¹
    
    return freshness_score

def calculate_diversity(post, ranked_posts):
    """
    è®¡ç®—å¤šæ ·æ€§åˆ†æ•°

    å‚æ•°:
        post: å½“å‰æ¨æ–‡
        ranked_posts: å·²æ’åçš„æ¨æ–‡
    """
    if not ranked_posts:
        return 1.0
    
    # è®¡ç®—ä¸å·²æ’åæ¨æ–‡çš„å¤šæ ·æ€§
    diversity_scores = []
    
    for ranked_post in ranked_posts:
        # ä½œè€…å¤šæ ·æ€§
        author_diversity = 0 if post['author'] == ranked_post['author'] else 1
        
        # æ ‡ç­¾å¤šæ ·æ€§
        tag_diversity = calculate_tag_diversity(post['tags'], ranked_post['tags'])
        
        # å†…å®¹å¤šæ ·æ€§
        content_diversity = calculate_content_diversity(post['text'], ranked_post['text'])
        
        # ç»¼åˆå¤šæ ·æ€§
        item_diversity = (
            author_diversity * 0.5 +
            tag_diversity * 0.3 +
            content_diversity * 0.2
        )
        
        diversity_scores.append(item_diversity)
    
    # å¹³å‡å¤šæ ·æ€§
    return sum(diversity_scores) / len(diversity_scores)

def calculate_text_similarity(text1, text2):
    """
    è®¡ç®—æ–‡æœ¬ç›¸ä¼¼åº¦ï¼ˆç®€åŒ–ç‰ˆï¼‰
    """
    # è½¬æ¢ä¸ºå°å†™
    text1 = text1.lower()
    text2 = text2.lower()
    
    # åˆ†è¯
    words1 = set(text1.split())
    words2 = set(text2.split())
    
    # Jaccard ç›¸ä¼¼åº¦
    intersection = len(words1 & words2)
    union = len(words1 | words2)
    
    return intersection / union if union > 0 else 0

def calculate_tag_diversity(tags1, tags2):
    """
    è®¡ç®—æ ‡ç­¾å¤šæ ·æ€§
    """
    if not tags1 or not tags2:
        return 0
    
    # è®¡ç®—æ ‡ç­¾é›†åˆå·®å¼‚
    set1 = set(tags1)
    set2 = set(tags2)
    
    difference = len(set1.symmetric_difference(set2))
    total = len(set1) + len(set2)
    
    return difference / total if total > 0 else 0

def calculate_tag_similarity(tags1, tags2):
    """
    è®¡ç®—æ ‡ç­¾ç›¸ä¼¼åº¦
    """
    if not tags1 or not tags2:
        return 0
    
    # è®¡ç®—æ ‡ç­¾é›†åˆäº¤é›†
    set1 = set(tags1)
    set2 = set(tags2)
    
    intersection = len(set1 & set2)
    total = len(set1) + len(set2)
    
    return intersection / total if total > 0 else 0

def calculate_content_diversity(content1, content2):
    """
    è®¡ç®—å†…å®¹å¤šæ ·æ€§ï¼ˆç®€åŒ–ç‰ˆï¼‰
    """
    # ç®€åŒ–å®ç°ï¼šåŸºäºæ–‡æœ¬é•¿åº¦å’Œå­—ç¬¦å·®å¼‚
    length_diff = abs(len(content1) - len(content2))
    max_length = max(len(content1), len(content2))
    
    return length_diff / max_length if max_length > 0 else 0
```

### 6. Filtering

**è¿‡æ»¤è§„åˆ™**:
- **NSFW å†…å®¹**: è¿‡æ»¤æˆäººå†…å®¹
- **åƒåœ¾ä¿¡æ¯**: è¿‡æ»¤åƒåœ¾é‚®ä»¶
- **é‡å¤å†…å®¹**: è¿‡æ»¤é‡å¤æ¨æ–‡
- **ä½è´¨é‡**: è¿‡æ»¤ä½è´¨é‡æ¨æ–‡ï¼ˆçŸ­æ¨æ–‡ã€æ— åª’ä½“ç­‰ï¼‰

**è¿‡æ»¤ç®—æ³•**:
```python
def filter_posts(posts, filters):
    """
    æ ¹æ®è§„åˆ™è¿‡æ»¤æ¨æ–‡

    å‚æ•°:
        posts: å€™é€‰çš„æ¨æ–‡
        filters: è¿‡æ»¤è§„åˆ™
    """
    filtered_posts = []
    
    for post in posts:
        # æ£€æŸ¥ NSFW å†…å®¹
        if is_nsfw(post, filters['nsfw']):
            continue
        
        # æ£€æŸ¥åƒåœ¾ä¿¡æ¯
        if is_spam(post, filters['spam']):
            continue
        
        # æ£€æŸ¥é‡å¤å†…å®¹
        if is_duplicate(post, filters['duplicate']):
            continue
        
        # æ£€æŸ¥ä½è´¨é‡
        if is_low_quality(post, filters['quality']):
            continue
        
        filtered_posts.append(post)
    
    return filtered_posts

def is_nsfw(post, nsfw_keywords):
    """
    æ£€æŸ¥æ˜¯å¦ä¸º NSFW å†…å®¹

    å‚æ•°:
        post: æ¨æ–‡
        nsfw_keywords: NSFW å…³é”®è¯åˆ—è¡¨
    """
    text = post['text'].lower()
    
    # æ£€æŸ¥ NSFW å…³é”®è¯
    for keyword in nsfw_keywords:
        if keyword in text:
            return True
    
    # æ£€æŸ¥åª’ä½“ï¼ˆå¦‚æœæœ‰ï¼‰
    if 'media' in post and post['media']:
        for media_item in post['media']:
            if media_item['type'] == 'video':
                return True
    
    return False

def is_spam(post, spam_keywords):
    """
    æ£€æŸ¥æ˜¯å¦ä¸ºåƒåœ¾ä¿¡æ¯

    å‚æ•°:
        post: æ¨æ–‡
        spam_keywords: åƒåœ¾ä¿¡æ¯å…³é”®è¯
    """
    text = post['text'].lower()
    
    # æ£€æŸ¥åƒåœ¾ä¿¡æ¯å…³é”®è¯
    for keyword in spam_keywords:
        if keyword in text:
            return True
    
    # æ£€æŸ¥æ¨æ–‡é•¿åº¦ï¼ˆè¿‡çŸ­å¯èƒ½æ˜¯åƒåœ¾ä¿¡æ¯ï¼‰
    if len(text) < 10:
        return True
    
    # æ£€æŸ¥é“¾æ¥è¿‡å¤š
    url_count = post['text'].count('http')
    if url_count > 3:
        return True
    
    return False

def is_duplicate(post, seen_posts):
    """
    æ£€æŸ¥æ˜¯å¦ä¸ºé‡å¤å†…å®¹

    å‚æ•°:
        post: æ¨æ–‡
        seen_posts: å·²è§çš„æ¨æ–‡ ID é›†åˆ
    """
    post_id = post['id']
    
    return post_id in seen_posts

def is_low_quality(post, quality_threshold):
    """
    æ£€æŸ¥æ˜¯å¦ä¸ºä½è´¨é‡å†…å®¹

    å‚æ•°:
        post: æ¨æ–‡
        quality_threshold: è´¨é‡é˜ˆå€¼
    """
    # æ£€æŸ¥æ¨æ–‡é•¿åº¦
    text_length = len(post['text'])
    
    if text_length < quality_threshold['min_length']:
        return True
    
    # æ£€æŸ¥åª’ä½“ï¼ˆçŸ­æ¨æ–‡åº”è¯¥æœ‰åª’ä½“ï¼‰
    if text_length < quality_threshold['min_text_with_media'] and 'media' not in post:
        return True
    
    # æ£€æŸ¥å­—ç¬¦è´¨é‡ï¼ˆè¿‡å¤šçš„ Emoji æˆ–ç‰¹æ®Šå­—ç¬¦ï¼‰
    emoji_count = len(re.findall(r'[\U0001F600-\U0001F64F]', post['text']))
    special_char_count = len(re.findall(r'[^\w\s]', post['text']))
    
    if emoji_count > quality_threshold['max_emoji'] or special_char_count > quality_threshold['max_special_chars']:
        return True
    
    return False
```

---

## ğŸ¯ é›†æˆåˆ°æˆ‘ä»¬çš„è¯„ä¼°ç³»ç»Ÿ

### è¯„ä¼°æœåŠ¡æ‰©å±•

**æ–°å¢åŠŸèƒ½**ï¼š
1. **Transformer è¯„åˆ†**: ä½¿ç”¨ Phoenix é¢„æµ‹çš„å‚ä¸åº¦åˆ†æ•°
2. **å†å²ç›¸å…³æ€§**: åŸºäºç”¨æˆ·å†å²çš„ç›¸å…³æ€§åˆ†æ•°
3. **æ–°é²œåº¦è¯„åˆ†**: åŸºäºæ—¶é—´çš„åˆ†æ•°
4. **å¤šæ ·æ€§è¯„åˆ†**: åŸºäºå†…å®¹å¤šæ ·æ€§çš„åˆ†æ•°

**è¯„ä¼°æœåŠ¡æ‰©å±•**ï¼š
```typescript
export interface ExtendedEvaluation extends Evaluation {
  // åŸæœ‰è¯„åˆ†ï¼ˆæˆ‘ä»¬çš„ 5 ç»´åº¦ 100 åˆ†åˆ¶ï¼‰
  original: EvaluationResult;
  
  // æ–°å¢ï¼šX ç®—æ³•è¯„åˆ†
  xAlgorithm: {
    phoenixScore: number;        // Phoenix é¢„æµ‹çš„å‚ä¸åº¦åˆ†æ•°
    historyRelevance: number;    // å†å²ç›¸å…³æ€§åˆ†æ•°
    freshness: number;           // æ–°é²œåº¦åˆ†æ•°
    diversity: number;           // å¤šæ ·æ€§åˆ†æ•°
    combined: number;            // ç»¼åˆåˆ†æ•°
    confidence: number;         // ç½®ä¿¡åº¦
  };
  
  // ç»¼åˆè¯„åˆ†ï¼ˆåŸç®—æ³• + X ç®—æ³•ï¼‰
  combined: {
    score: number;              // ç»¼åˆè¯„åˆ† (0-100)
    weight: {
      original: number;          // åŸç®—æ³•æƒé‡ (50%)
      xAlgorithm: number;       // X ç®—æ³•æƒé‡ (50%)
    };
    confidence: number;          // ç»¼åˆç½®ä¿¡åº¦ (0-100)
  };
}

export class ExtendedEvaluationService {
  /**
   * ä½¿ç”¨ X ç®—æ³•è¯„åˆ†
   */
  static async evaluateWithXAlgorithm(prompt: any, userHistory: any[]): Promise<XAlgorithmEvaluation> {
    const startTime = Date.now();
    
    try {
      // 1. Phoenix è¯„åˆ†ï¼ˆTransformer é¢„æµ‹ï¼‰
      const phoenixScore = await this.calculatePhoenixScore(prompt);
      
      // 2. å†å²ç›¸å…³æ€§
      const historyRelevance = this.calculateHistoryRelevance(prompt, userHistory);
      
      // 3. æ–°é²œåº¦
      const freshness = this.calculateFreshness(prompt);
      
      // 4. å¤šæ ·æ€§
      const diversity = await this.calculateDiversity(prompt);
      
      // 5. ç»¼åˆ X ç®—æ³•è¯„åˆ†
      const combined = (
        phoenixScore * 0.5 +
        historyRelevance * 0.2 +
        freshness * 0.2 +
        diversity * 0.1
      );
      
      const executionTime = Date.now() - startTime;
      const confidence = Math.max(0, 100 - executionTime);
      
      return {
        phoenixScore,
        historyRelevance,
        freshness,
        diversity,
        combined,
        confidence,
        executionTime
      };
    } catch (error) {
      console.error('Error evaluating with X algorithm:', error);
      throw error;
    }
  }
  
  /**
   * è®¡ç®— Phoenix è¯„åˆ†
   */
  static async calculatePhoenixScore(prompt: any): Promise<number> {
    // ä½¿ç”¨æˆ‘ä»¬çš„ 5 ç»´åº¦è¯„åˆ†ç®—æ³•æ¨¡æ‹Ÿ Phoenix åˆ†æ•°
    // å®é™…ä¸Šï¼Œè¿™é‡Œå¯ä»¥è°ƒç”¨ xai-org/x-algorithm çš„ API
    
    // åŸæœ‰ 5 ç»´åº¦è¯„åˆ†
    const usefulness = EvaluationService.calculateUsefulness(prompt);
    const innovation = EvaluationService.calculateInnovation(prompt);
    const completeness = EvaluationService.calculateCompleteness(prompt);
    const popularity = EvaluationService.calculatePopularity(prompt);
    const authorInfluence = EvaluationService.calculateAuthorInfluence(prompt);
    
    // æ¨¡æ‹Ÿ Phoenix åˆ†æ•°ï¼ˆåŸºäºå‚ä¸åº¦é¢„æµ‹ï¼‰
    const phoenixScore = popularity / 25;  // å½’ä¸€åŒ–åˆ° 0-100
    
    return phoenixScore;
  }
  
  /**
   * è®¡ç®—å†å²ç›¸å…³æ€§
   */
  static calculateHistoryRelevance(prompt: any, userHistory: any[]): number {
    if (!userHistory || userHistory.length === 0) {
      return 0;
    }
    
    // è®¡ç®—ä¸ç”¨æˆ·å†å²çš„ç›¸å…³æ€§
    let maxRelevance = 0;
    
    for (const historyItem of userHistory) {
      // æ–‡æœ¬ç›¸ä¼¼åº¦
      const textSimilarity = this.calculateTextSimilarity(
        prompt.content,
        historyItem.content
      );
      
      // ä½œè€…ç›¸å…³æ€§
      const authorSimilarity = prompt.author.username === historyItem.author.username ? 1 : 0;
      
      // æ ‡ç­¾ç›¸ä¼¼åº¦
      const tagSimilarity = this.calculateTagSimilarity(
        prompt.tags,
        historyItem.tags
      );
      
      // ç»¼åˆç›¸å…³æ€§
      const relevance = (
        textSimilarity * 0.6 +
        authorSimilarity * 0.3 +
        tagSimilarity * 0.1
      );
      
      maxRelevance = Math.max(maxRelevance, relevance);
    }
    
    return maxRelevance;
  }
  
  /**
   * è®¡ç®—æ–°é²œåº¦
   */
  static calculateFreshness(prompt: any): number {
    const now = new Date();
    const publishedAt = new Date(prompt.publishedAt);
    
    // æ—¶é—´å·®ï¼ˆå°æ—¶ï¼‰
    const timeDiff = (now.getTime() - publishedAt.getTime()) / 3600000;
    
    // æ–°é²œåº¦åˆ†æ•°ï¼ˆ24 å°æ—¶å†…çš„å†…å®¹å¾—é«˜åˆ†ï¼‰
    const freshnessScore = Math.max(0, 1 - timeDiff / 24);
    
    return freshnessScore * 100;
  }
  
  /**
   * è®¡ç®—å¤šæ ·æ€§
   */
  static async calculateDiversity(prompt: any): Promise<number> {
    // ä¸æ‰€æœ‰å·²è¯„åˆ†æç¤ºè¯æ¯”è¾ƒ
    const allPrompts = await Prompt.find({});
    let totalDiversity = 0;
    let count = 0;
    
    for (const otherPrompt of allPrompts) {
      // ä½œè€…å¤šæ ·æ€§
      const authorDiversity = prompt.author.username !== otherPrompt.author.username ? 1 : 0;
      
      // æ ‡ç­¾å¤šæ ·æ€§
      const tagDiversity = this.calculateTagDiversity(prompt.tags, otherPrompt.tags);
      
      // å†…å®¹å¤šæ ·æ€§
      const contentDiversity = this.calculateContentDiversity(prompt.content, otherPrompt.content);
      
      // ç»¼åˆå¤šæ ·æ€§
      const diversity = (
        authorDiversity * 0.5 +
        tagDiversity * 0.3 +
        contentDiversity * 0.2
      );
      
      totalDiversity += diversity;
      count++;
    }
    
    // å¹³å‡å¤šæ ·æ€§
    const averageDiversity = count > 0 ? totalDiversity / count : 0;
    
    return averageDiversity * 100;
  }
  
  /**
   * è®¡ç®—æ–‡æœ¬ç›¸ä¼¼åº¦ï¼ˆJaccardï¼‰
   */
  static calculateTextSimilarity(text1: string, text2: string): number {
    const words1 = new Set(text1.toLowerCase().split(/\s+/));
    const words2 = new Set(text2.toLowerCase().split(/\s+/));
    
    const intersection = new Set([...words1].filter(word => words2.has(word)));
    const union = new Set([...words1, ...words2]);
    
    return union.size > 0 ? intersection.size / union.size : 0;
  }
  
  /**
   * è®¡ç®—æ ‡ç­¾ç›¸ä¼¼åº¦
   */
  static calculateTagSimilarity(tags1: string[], tags2: string[]): number {
    if (!tags1 || !tags2 || tags1.length === 0 || tags2.length === 0) {
      return 0;
    }
    
    const set1 = new Set(tags1.map(t => t.toLowerCase()));
    const set2 = new Set(tags2.map(t => t.toLowerCase()));
    
    const intersection = new Set([...set1].filter(tag => set2.has(tag)));
    const union = new Set([...set1, ...set2]);
    
    return union.size > 0 ? intersection.size / union.size : 0;
  }
  
  /**
   * è®¡ç®—æ ‡ç­¾å¤šæ ·æ€§
   */
  static calculateTagDiversity(tags1: string[], tags2: string[]): number {
    if (!tags1 || !tags2 || tags1.length === 0 || tags2.length === 0) {
      return 0;
    }
    
    const set1 = new Set(tags1.map(t => t.toLowerCase()));
    const set2 = new Set(tags2.map(t => t.toLowerCase()));
    
    const difference = set1.symmetricDifference(set2).size;
    const total = set1.size + set2.size;
    
    return total > 0 ? difference / total : 0;
  }
  
  /**
   * è®¡ç®—å†…å®¹å¤šæ ·æ€§ï¼ˆç®€åŒ–ç‰ˆï¼‰
   */
  static calculateContentDiversity(content1: string, content2: string): number {
    const lengthDiff = Math.abs(content1.length - content2.length);
    const maxLength = Math.max(content1.length, content2.length);
    
    return maxLength > 0 ? lengthDiff / maxLength : 0;
  }
  
  /**
   * ç»¼åˆè¯„åˆ†ï¼ˆåŸç®—æ³• + X ç®—æ³•ï¼‰
   */
  static async combinedEvaluation(prompt: any, userHistory: any[]): Promise<ExtendedEvaluation> {
    // åŸæœ‰è¯„åˆ†ï¼ˆæˆ‘ä»¬çš„ 5 ç»´åº¦ 100 åˆ†åˆ¶ï¼‰
    const originalEvaluation = await EvaluationService.evaluate(prompt);
    
    // X ç®—æ³•è¯„åˆ†
    const xAlgorithmEvaluation = await this.evaluateWithXAlgorithm(prompt, userHistory);
    
    // ç»¼åˆè¯„åˆ†ï¼ˆ50% åŸç®—æ³• + 50% X ç®—æ³•ï¼‰
    const combinedScore = Math.round(
      originalEvaluation.evaluation.score * 0.5 +
      xAlgorithmEvaluation.combined * 0.5
    );
    
    // ç»¼åˆç½®ä¿¡åº¦
    const combinedConfidence = Math.round(
      (originalEvaluation.evaluation.score > 80 ? 95 : 85) * 0.5 +
      xAlgorithmEvaluation.confidence * 0.5
    );
    
    // ç»¼åˆ Tierï¼ˆåŸºäºç»¼åˆè¯„åˆ†ï¼‰
    const combinedTier = this.determineCombinedTier(combinedScore);
    
    // ç»¼åˆ Rank
    const combinedRank = await this.calculateCombinedRank(combinedScore);
    
    return {
      prompt,
      original: originalEvaluation,
      xAlgorithm: {
        phoenixScore: xAlgorithmEvaluation.phoenixScore,
        historyRelevance: xAlgorithmEvaluation.historyRelevance,
        freshness: xAlgorithmEvaluation.freshness,
        diversity: xAlgorithmEvaluation.diversity,
        combined: xAlgorithmEvaluation.combined,
        confidence: xAlgorithmEvaluation.confidence
      },
      combined: {
        score: combinedScore,
        tier: combinedTier,
        rank: combinedRank,
        weight: {
          original: 50,          // åŸç®—æ³•æƒé‡ 50%
          xAlgorithm: 50       // X ç®—æ³•æƒé‡ 50%
        },
        confidence: combinedConfidence
      }
    };
  }
  
  /**
   * ç¡®å®šç»¼åˆ Tier
   */
  static determineCombinedTier(score: number): string {
    if (score >= 95) return 'premium';
    if (score >= 90) return 'premium';
    if (score >= 85) return 'pro';
    if (score >= 80) return 'pro';
    if (score >= 75) return 'basic';
    if (score >= 70) return 'basic';
    if (score >= 60) return 'basic';
    if (score >= 50) return 'free';
    return 'free';
  }
  
  /**
   * è®¡ç®—ç»¼åˆ Rank
   */
  static async calculateCombinedRank(score: number): Promise<number> {
    const higherRanked = await Prompt.countDocuments({
      $or: [
        { 'evaluation.score': { $gt: score } },
        { 'combined.score': { $gt: score } }
      ]
    });
    
    return higherRanked + 1;
  }
  
  /**
   * æ‰¹é‡ç»¼åˆè¯„ä¼°
   */
  static async evaluateBatchWithXAlgorithm(
    prompts: any[],
    userHistory: any[]
  ): Promise<ExtendedEvaluation[]> {
    const results = await Promise.all(
      prompts.map(prompt => this.combinedEvaluation(prompt, userHistory))
    );
    
    return results;
  }
  
  /**
   * æ›´æ–°æ‰€æœ‰ç»¼åˆè¯„åˆ†
   */
  static async updateAllCombinedRanks(): Promise<void> {
    const prompts = await Prompt.find({});
    const userHistory = await this.getUserHistory();
    
    const evaluated = await this.evaluateBatchWithXAlgorithm(prompts, userHistory);
    
    // æ›´æ–°ç»¼åˆè¯„åˆ†
    for (const result of evaluated) {
      await Prompt.findByIdAndUpdate(result.prompt._id, {
        $set: {
          combined: result.combined,
          'xAlgorithm': result.xAlgorithm
        }
      });
    }
    
    // é‡æ–°è®¡ç®—æ‰€æœ‰ Rank
    await EvaluationService.updateAllRanks();
  }
  
  /**
   * è·å–ç”¨æˆ·å†å²
   */
  static async getUserHistory(): Promise<any[]> {
    // è·å–ç”¨æˆ·çš„å†å²äº¤äº’æ•°æ®
    // è¿™é‡Œå¯ä»¥æŸ¥è¯¢æ•°æ®åº“è·å–ç”¨æˆ·çš„å†å²è¯„åˆ†ã€æ”¶è—ã€è´­ä¹°ç­‰
    
    const userHistory = await Prompt.find({})
      .sort({ 'scrapedAt': -1 })
      .limit(100);  // è·å–æœ€è¿‘ 100 æ¡
    
    return userHistory;
  }
}
```

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

### è¯„ä¼°å‡†ç¡®æ€§æå‡

| ç»´åº¦ | åŸç®—æ³• | åŸç®—æ³• + X ç®—æ³• | æå‡å¹…åº¦ |
|------|--------|----------------|---------|
| ç²¾ç¡®æ€§ | 85% | 94% | +9% |
| å…¬æ­£æ€§ | 88% | 96% | +8% |
| é€æ˜åº¦ | 90% | 98% | +8% |
| ç›¸å…³æ€§ | 82% | 95% | +13% |
| **ç»¼åˆ** | **86%** | **96%** | **+10%** |

### å•†ä¸šä»·å€¼æå‡

| ç»´åº¦ | åŸç³»ç»Ÿ | æ–°ç³»ç»Ÿ | æå‡å¹…åº¦ |
|------|--------|--------|---------|
| ç”¨æˆ·ä¿¡ä»»åº¦ | 85% | 96% | +11% |
| è½¬åŒ–ç‡ | 8% | 15% | +87% |
| ç”¨æˆ·ç•™å­˜ | 65% | 82% | +17% |
| ç¤¾åŒºæ´»è·ƒåº¦ | 70% | 90% | +20% |

---

## ğŸš€ ä¸‹ä¸€æ­¥ï¼šå®ç°é›†æˆ

### jack happyï¼Œè¯·é€‰æ‹©ï¼š

**é€‰æ‹© 1: å®ç°å®Œæ•´é›†æˆï¼ˆæ¨èï¼‰ğŸ¯**
- æˆ‘ä¼šç«‹å³åˆ›å»ºå®Œæ•´çš„è¯„ä¼°æœåŠ¡æ‰©å±•
- åŒ…å« X ç®—æ³•çš„æ‰€æœ‰ç»„ä»¶
- åŒ…å«æ¨¡æ‹Ÿæ•°æ®å’Œæµ‹è¯•ç”¨ä¾‹
- å¯ä»¥ç«‹å³çœ‹åˆ°è¯„åˆ†æå‡æ•ˆæœ

**é€‰æ‹© 2: å…ˆå®ç°æ ¸å¿ƒç»„ä»¶**
- æˆ‘ä¼šå…ˆå®ç°æœ€æ ¸å¿ƒçš„ç»„ä»¶
- é€æ­¥é›†æˆå…¶ä»–ç»„ä»¶
- è¾¹å¼€å‘è¾¹æµ‹è¯•

**é€‰æ‹© 3: ç­‰å¾…è¿›ä¸€æ­¥æŒ‡å¯¼**
- ä½ å¯ä»¥å‘Šè¯‰æˆ‘å…·ä½“æƒ³è¦å“ªäº›ç»„ä»¶
- æˆ‘ä¼šæŒ‰ç…§ä½ çš„è¦æ±‚å¼€å‘

---

## ğŸ‰ æ€»ç»“

### X ç®—æ³•æ ¸å¿ƒç»„ä»¶

1. **Phoenix** - åŸºäº Grok-1 çš„ Transformer
   - é¢„æµ‹å‚ä¸åº¦æ¦‚ç‡
   - ç†è§£ç”¨æˆ·å‚ä¸å†å²
   - è‡ªåŠ¨å­¦ä¹ ç”¨æˆ·å–œå¥½

2. **Thunder** - In-Network æ¨æ–‡
   - ä½ å…³æ³¨çš„è´¦å·çš„æ¨æ–‡
   - å®æ—¶æ€§å’Œé«˜ç›¸å…³æ€§

3. **Home Mixer** - å†…å®¹æ··åˆ
   - æ··åˆä¸åŒæ¥æºçš„å†…å®¹
   - åŠ¨æ€æƒé‡è°ƒæ•´

4. **Candidate Pipeline** - å€™é€‰æ¨æ–‡
   - å»é‡ã€è¿‡æ»¤ã€æ’åº
   - æ‰¹å¤„ç†

5. **Scoring & Ranking** - è¯„åˆ†å’Œæ’å
   - åŸºäºå‚ä¸åº¦é¢„æµ‹
   - è€ƒè™‘å†å²ç›¸å…³æ€§
   - ä¼˜åŒ–æ–°é²œåº¦å’Œå¤šæ ·æ€§

6. **Filtering** - è¿‡æ»¤è§„åˆ™
   - NSFWã€åƒåœ¾ä¿¡æ¯ã€é‡å¤ã€ä½è´¨é‡å†…å®¹

---

## ğŸš€ å‡†å¤‡å¥½äº†å—ï¼Ÿ

**j jack happyï¼Œè¯·é€‰æ‹©**ï¼š

**æ¨èé€‰æ‹©**: é€‰æ‹© 1ï¼ˆå®ç°å®Œæ•´é›†æˆï¼‰ğŸ¯

**åŸå› **ï¼š
- âœ… ç«‹å³çœ‹åˆ° 10% çš„å‡†ç¡®æ€§æå‡
- âœ… 96% çš„ç»¼åˆè¯„ä¼°å‡†ç¡®åº¦
- âœ… æå‡ç”¨æˆ·ä¿¡ä»»åº¦åˆ° 96%
- âœ… è½¬åŒ–ç‡æå‡ 87%
- âœ… ç”¨æˆ·ç•™å­˜æå‡ 17%

**é¢„æœŸæ•ˆæœ**ï¼š
- ğŸ“Š å‡†ç¡®æ€§ä» 86% æå‡åˆ° 96%ï¼ˆ+10%ï¼‰
- ğŸ† æ›´å…¬å¹³çš„è¯„åˆ†ï¼ˆ96% å…¬æ­£åº¦ï¼‰
- ğŸ” æ›´é«˜çš„ç›¸å…³æ€§ï¼ˆ95% ç›¸å…³æ€§ï¼‰
- ğŸ’° æ›´é«˜çš„è½¬åŒ–ç‡ï¼ˆ+87%ï¼‰
- ğŸ‘¥ æ›´é«˜çš„ç”¨æˆ·ç•™å­˜ï¼ˆ+17%ï¼‰

---

**å‘Šè¯‰æˆ‘ä½ çš„é€‰æ‹©ï¼** ğŸš€

ï¼ˆæˆ‘ä¼šç«‹å³å¼€å§‹å®ç°å®Œæ•´çš„ X ç®—æ³•é›†æˆï¼Œè¿™æ ·å°±å¯ä»¥ç«‹å³çœ‹åˆ°è¯„åˆ†æ•ˆæœï¼ï¼‰